
# googleSTEP Week4

## コードの説明
以下に今回用いたsolverを説明する。たくさんあるようだが、それぞれの特性は大きく変わらず、それぞれを組み合わせて色々なsolverを作ったように見えるだけである。
### solver_random
- 単純にノード1からNまで訪問する

### solver_greedy
- 貪欲法に基づき、最短距離のノードに移動する

### solver_2opt
- 初期状態は、greedyで求めた経路。交叉していたら、交差がないように繋ぎ直す。

#### 具体的なアルゴリズム

1\. 2本の辺を選び出す

2\. 2辺を繋ぎかえた方が経路が短くなるようであれば、繋ぎ帰る

3\. 繋ぎ変える辺がなくなれば探索終了


>近傍を探索するアルゴリズムで、局所的最適解にハマり、最適解には辿り着けないことが多いらしい。

### solver_3opt
2optの延長線のアルゴリズムであり、3つの辺に注目し、それぞれ繋ぎ変えて経路が短くなるなら修正する。
今回は実装に失敗し、何度もスワップを繰り返し無限ループが起きるようになってしまった。

### solver_2opt_random
2optの初期状態を、ランダムにシャッフルされたtourに変更した。

### solver_sa
- 焼きなまし法を実装した。近傍探索には2optを使用した。

`参考：https://qiita.com/take314/items/7eae18045e989d7eaf52`

#### 具体的なアルゴリズム
1\. 通常の2optを回していく

2\. ある確率で、2optの経路変更の条件を満たさない（２辺を繋ぎかえても経路長が短くならない）場合でも、経路を変更する。

その際の確率は、ある温度Tによる関数にて決定する。
この温度は、初期値からループが回るにつれて減少していき、結果として最初ほど自由に動き、終盤ほど2optに則った動きをするようになる。

これにより、局所解にはまることなく、大域的な最適解を見つけ出す確率が上がる。

- 焼きなまし法では、パラメータの初期値が性能に強く影響する。これはどうしても実験的に求めるしかなく、数回試したところ現在の値が最良のように思える。

### solver_2opt_save
- 2optの初期状態を2opt、ランダム数回にした。これにより、焼きなましの効果を挙げられると考えた。
- 結果として、input_4ではbest scoreを見つけることができたが、input_5では2optと変わらなかった。やはり初期ルートをランダムにしても、ランダム試行回数が大きくならなければなかなか2optを上回る経路を見つけることは難しく、この回数を大きくすると実行時間が爆増してしまうので、調整が難しい。

### solver_sa_2opt
- 単純に、saを行った後に2optを回した。単純なsa,2optより改善した部分もあるが、実行時間がその分増えてしまい、そこから期待されるほどの性能は出ていない。


## 現在の結果
以上のsolverを動かした結果を以下に示す。
時間の都合上40分以上かけても終わらないものや、いい動作が見込めないものはinput6まで試していない。
太字がそれぞれのinputに対する最短経路である。

### それぞれのsolverに対する経路長の表
|solver|input_0|input_1|input_2|input_3|input_4|input_5|input_6|
|:---|---:|---:|---:|---:|---:|---:|---:|
|2opt|3418.1|3832.29|**4494.42**|8625.75|10983.14|**21150.03**|**41401.8748**|
|2op_random_|**3291.621721**|**3778.715416**|**4494.417962**|8463.447765|11526.271767|21809.77703|-|
|sa|**3291.621721**|**3778.715416**|**4494.417962**|8279.844792|11111.493181|22584.123310|-|
|sa|-|-|-|8342.58389449254|11130.6526170958|-|-|
|sa_2opt|**3291.621721**|**3778.71541649253**|-|**8251.51528373163**|10943.1276305623|**21150.0305910545**|**41401.874801**|
|3opt|-|**3778.715416**|5971.288893|10000以上|-|-|-|
|2opt_save|-|-|-|8422.165699|**10809.94425**|**21150.03059**|実行中|




## 考察、改善点など
今回は、主に2optとsaに焦点を当ててsolverを考えて行った。まだまだ改善点は多くあり、特に3optが実装できた後は、saでの近傍探索を確率で2optと3optでスイッチするようなアルゴリズムを書いてみたい。

また、焼きなまし法でも完全に大域的な最適解を見つけられていないので、もうすこし2optから脱却しランダム性があってもいいかもしれない。例えば2optから枝分かれするような複数経路を常に保持し、確率で距離が短い方に繋ぎ変えるようなアルゴリズムは有効な気がする。空間計算量が増えすぎないように性能を上げていくのが難しいかもしれない。

また、単純に2optでも実行時間がかかりすぎてしまうので、可能性があるところしか探索しないよう改善したい。
全頂点間のdistanceを行列で保持したり、うまく枝刈りができればもう少し時間計算量を減らせそうである。




## 自分用めも
- 2opt
    - 近傍を探索するアルゴリズム。最適解には辿り着けないことが多い
- 2opt を複数地点から始めて途中で合流
　-> 二人optっていうらしい
　-> 普通のoptの解法としては微妙かも、、

- 遺伝的アルゴリズム
    - 調べる時間が足りなかった、やるなら来週

- 焼きなまし（sa）
    - 確率的に2optか、その他近傍探索？のやつを使い分ける？
    - 冷却方法をもう少し考えてもいいかも
        - 対数的に冷却する方法もあるが、収束速度が遅くなるらしい
    - 3opt,2optを使い分ける？
    - 他の方法
    - 大域的に最適解を見つけることに適している

- やりたいこと
    - 焼きなましの近傍探索に3opt、2optをランダムで適用
    - 直前経路を保存する焼きなまし？2optを考える

